---
title: "Mini-Project 2"
author: "Shuli Hu, Karina Huang, Iris Dong"
date: "October 31, 2017"
output: html_document
---


## Loading the data

```{r}
library(tidyverse)
library(dplyr)
```

```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
```

```{r}
## Karina 10.29.17

con <- contributions %>%
  filter(transaction_type == "24E" | transaction_type == "24A") %>%
  mutate(entity_type = ifelse(entity_type == "", "NA", entity_type)) %>%
  group_by(cand_id) %>% 
  summarise(pro.CAN = sum(transaction_amt[entity_type == "CAN" & transaction_type == "24E"]), ## Summarise independent expediture by entity (payee) types and transaction types 
            pro.CCM = sum(transaction_amt[entity_type == "CCM" & transaction_type == "24E"]),
            pro.COM = sum(transaction_amt[entity_type == "COM" & transaction_type == "24E"]),
            pro.IND = sum(transaction_amt[entity_type == "IND" & transaction_type == "24E"]),
            pro.ORG = sum(transaction_amt[entity_type == "ORG" & transaction_type == "24E"]),
            pro.PAC = sum(transaction_amt[entity_type == "PAC" & transaction_type == "24E"]),
            pro.PTY = sum(transaction_amt[entity_type == "PTY" & transaction_type == "24E"]),
            pro.NA = sum(transaction_amt[entity_type == "NA" & transaction_type == "24E"]),
            con.Can = sum(transaction_amt[entity_type == "CAN" & transaction_type == "24A"]),
            con.CCM = sum(transaction_amt[entity_type == "CCM" & transaction_type == "24A"]),
            con.COM = sum(transaction_amt[entity_type == "COM" & transaction_type == "24A"]),
            con.IND = sum(transaction_amt[entity_type == "IND" & transaction_type == "24A"]),
            con.ORG = sum(transaction_amt[entity_type == "ORG" & transaction_type == "24A"]),
            con.PAC = sum(transaction_amt[entity_type == "PAC" & transaction_type == "24A"]),
            con.PTY = sum(transaction_amt[entity_type == "PTY" & transaction_type == "24A"]),
            con.NA = sum(transaction_amt[entity_type == "NA" & transaction_type == "24A"])) %>%
  select(cand_id:con.NA)

cand.id <- c(con$cand_id)

can <- candidates %>% ## New candidate dataset
  filter(cand_id %in% c(cand.id)) %>% ## Filtering out ids not reflected in the contribution dataset
  select(cand_id:cand_office, cand_ici:cand_status) 

pro.type <- c("pro.CAN","pro.CCM","pro.COM","pro.IND","pro.ORG","pro.PAC","pro.PTY","pro.NA")
con.type <- c("con.CAN","con.CCM","con.COM","con.IND","con.ORG","con.PAC","con.PTY","con.NA")

election <- full_join(can, con, by = "cand_id") %>% 
  mutate(pro.sum = pro.CAN+pro.CCM+pro.COM+pro.IND+pro.ORG+pro.PAC+pro.PTY+pro.NA, 
          con.sum = con.Can+con.CCM+con.COM+con.IND+con.ORG+con.PAC+con.PTY+con.NA) %>%
  group_by(cand_party_affiliation) %>%
  summarise(pro.CAN = sum(pro.CAN), pro.CCM = sum(pro.CCM), pro.COM = sum(pro.COM),
            pro.IND = sum(pro.IND), pro.ORG = sum(pro.ORG), pro.PAC = sum(pro.PAC),
            pro.PTY = sum(pro.PTY), pro.NA = sum(pro.NA), 
            con.CAN = sum(con.Can), con.CCM = sum(con.CCM), con.COM = sum(con.COM),
            con.IND = sum(con.IND), con.ORG = sum(con.ORG), con.PAC = sum(con.PAC),
            con.PTY = sum(con.PTY), con.NA = sum(con.NA), pro.sum = sum(pro.sum), con.sum = sum(con.sum)) %>%
  filter(cand_party_affiliation == "DEM" | cand_party_affiliation == "REP") %>%
  gather("type", "amount",pro.CAN:con.NA) %>%
  mutate(transaction.type = ifelse(type %in% c(pro.type), "pro", "con"),
         entity.type = ifelse(type %in% "pro.CAN" | type %in% "con.CAN", "CAN", 
                              ifelse(type %in% "pro.CCM" | type %in% "con.CCM", "CCM", 
                                     ifelse(type %in% "pro.COM" | type %in% "con.COM", "COM", 
                                            ifelse(type %in% "pro.IND" | type %in% "con.IND", "IND", 
                                                   ifelse(type %in% "pro.ORG" | type %in% "con.ORG", "ORG", 
                                                          ifelse(type %in% "pro.PAC" | type %in% "con.PAC", "PAC",
                                                                 ifelse(type %in% "pro.PTY" | type %in% "con.PTY", "PTY",
                                                                        ifelse(type %in% "pro.NA" | type %in% "con.NA", "NA", type))))))))) %>%
  select(-type) %>%
  spread(transaction.type, amount) %>%
  select(-pro.sum, -con.sum) %>%
  gather("transaction.type", "amount", con:pro)



```

pro.type <- c("pro.CAN","pro.CCM","pro.COM","pro.IND","pro.ORG","pro.PAC","pro.PTY","pro.NA")
con.type <- c("con.CAN","con.CCM","con.COM","con.IND","con.ORG","con.PAC","con.PTY","con.NA")

election2 <- election %>%
  gather("type", "amount",pro.CAN:con.NA) %>%
  select(cand_id, cand_party_affiliation, type, amount) %>%
  mutate(transaction.type = ifelse(type %in% c(pro.type), "pro", "con"),
         entity.type = ifelse(type %in% "pro.CAN" | type %in% "con.CAN", "CAN", 
                              ifelse(type %in% "pro.CCM" | type %in% "con.CCM", "CCM", 
                                     ifelse(type %in% "pro.COM" | type %in% "con.COM", "COM", 
                                            ifelse(type %in% "pro.IND" | type %in% "con.IND", "IND", 
                                                   ifelse(type %in% "pro.ORG" | type %in% "con.ORG", "ORG", 
                                                          ifelse(type %in% "pro.PAC" | type %in% "con.PAC", "PAC",
                                                                 ifelse(type %in% "pro.PTY" | type %in% "con.PTY", "PTY",
                                                                        ifelse(type %in% "pro.NA" | type %in% "con.NA", "NA", type)))))))))

election3 <- election2 %>%
  filter(cand_party_affiliation == "DEM" | cand_party_affiliation == "REP")


con <- contributions %>%  ## New contribution dataset 
  filter(transaction_type == "24E" | transaction_type == "24A") %>% ## Filtering for transaction type: advocating and opposing election
  group_by(cand_id) %>% 
  summarise(pro.CAN = sum(transaction_amt[entity_type == "CAN" & transaction_type == "24E"]), ## Summarise independent expediture by entity (payee) types and transaction types 
            pro.CCM = sum(transaction_amt[entity_type == "CCM" & transaction_type == "24E"]),
            pro.COM = sum(transaction_amt[entity_type == "COM" & transaction_type == "24E"]),
            pro.IND = sum(transaction_amt[entity_type == "IND" & transaction_type == "24E"]),
            pro.ORG = sum(transaction_amt[entity_type == "ORG" & transaction_type == "24E"]),
            pro.PAC = sum(transaction_amt[entity_type == "PAC" & transaction_type == "24E"]),
            pro.PTY = sum(transaction_amt[entity_type == "PTY" & transaction_type == "24E"]),
            con.Can = sum(transaction_amt[entity_type == "CAN" & transaction_type == "24A"]),
            con.CCM = sum(transaction_amt[entity_type == "CCM" & transaction_type == "24A"]),
            con.COM = sum(transaction_amt[entity_type == "COM" & transaction_type == "24A"]),
            con.IND = sum(transaction_amt[entity_type == "IND" & transaction_type == "24A"]),
            con.ORG = sum(transaction_amt[entity_type == "ORG" & transaction_type == "24A"]),
            con.PAC = sum(transaction_amt[entity_type == "PAC" & transaction_type == "24A"]),
            con.PTY = sum(transaction_amt[entity_type == "PTY" & transaction_type == "24A"])) %>%
  select(cand_id:con.PTY)


cand.id <- c(con$cand_id) ## Vector for all ids in the new contribution dataset


can <- candidates %>% ## New candidate dataset
  filter(cand_id %in% c(cand.id)) %>% ## Filtering out ids not reflected in the contribution dataset
  select(cand_id:cand_office, cand_ici:cand_status) 

election <- full_join(can, con, by = "cand_id") %>% ## New dataset by joining candidate and contribution dataset
   mutate(pro.sum = pro.CAN+pro.CCM+pro.COM+pro.IND+pro.ORG+pro.PAC+pro.PTY, ## Sums of expediture by type
          con.sum = con.Can+con.CCM+con.COM+con.IND+con.ORG+con.PAC+con.PTY)

election2 <- election %>%
  gather("type", "amount",pro.CAN:con.PTY)


```{r}
## Karina Test 10.29.17

library(ggplot2)

ggplot(election, aes(x=entity.type, y=amount, fill=transaction.type)) + 
  geom_bar(stat = "identity", position = "dodge") + 
  facet_wrap(~cand_party_affiliation)
```


















































>>>>>>> 521d75e56e541d7eb04b56e48f2bfda83bd74260
